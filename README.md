# Secret Santa Telegram Bot

Бот для организации Тайного Санты в Telegram на .NET 9.

## Возможности

- Регистрация участников
- Управление пожеланиями, ссылками на почтовые отделения и номерами телефонов
- Чёрный список участников
- Жеребьёвка с учётом чёрного списка
- Анонимная переписка между дарителями и получателями
- Административные команды для управления игрой

## Требования

- .NET 9 SDK
- Telegram Bot Token (получить у [@BotFather](https://t.me/BotFather))

## Установка

1. Клонируйте репозиторий или скачайте проект

2. Откройте `appsettings.json` и укажите:
   ```json
   {
     "BotToken": "ВАШ_ТОКЕН_БОТА",
     "AdminUserIds": [123456789, 987654321]
   }
   ```
   - `BotToken`: токен вашего бота от BotFather
   - `AdminUserIds`: массив Telegram User ID администраторов (можно узнать через бота [@userinfobot](https://t.me/userinfobot))

3. Восстановите зависимости:
   ```bash
   dotnet restore
   ```

4. Запустите бота:
   ```bash
   dotnet run
   ```

## Команды для пользователей

- `/start` или `/help` - Показать список доступных команд
- `/register` - Зарегистрироваться
- `/myinfo` - Посмотреть свою информацию
- `/recipientinfo` - Посмотреть информацию получателя
- `/updatewishes <текст>` - Обновить пожелания
- `/update_destination <текст>` - Обновить адрес доставки 
- `/updatephone <номер>` - Обновить номер телефона
- `/blacklist add @username` - Добавить пользователя в чёрный список
- `/blacklist remove @username` - Удалить пользователя из чёрного списка
- `/blacklist list` - Показать чёрный список
- `/message sender <текст>` - Отправить анонимное сообщение тому, кто вам дарит
- `/message recipient <текст>` - Отправить анонимное сообщение тому, кому вы дарите

## Команды для администраторов

- `/adduser @username` - Добавить участника вручную
- `/shuffle` - Провести жеребьёвку (автоматически отправляет информацию получателям)
- `/sendinfo` - Повторно отправить информацию получателям
- `/participants` - Список всех зарегистрированных участников
- `/stats` - Статистика (количество участников, статус жеребьёвки)

## Как это работает

1. **Регистрация**: Участники регистрируются через команду `/register` и заполняют свою информацию (пожелания, адрес доставки, телефон)

2. **Чёрный список**: Каждый участник может добавить в чёрный список тех, кому не хочет дарить подарок

3. **Жеребьёвка**: Администратор запускает жеребьёвку командой `/shuffle`. Бот автоматически:
   - Распределяет участников с учётом чёрного списка
   - Отправляет каждому дарителю информацию о его получателе (пожелания, адрес доставки, телефон)

4. **Анонимная переписка**: После жеребьёвки участники могут отправлять анонимные сообщения:
   - Своему дарителю (команда `/message sender`)
   - Своему получателю (команда `/message recipient`)
   - Сообщения помечаются как "от того, кто вам дарит" или "от того, кому вы дарите"

## База данных

Бот использует SQLite базу данных (`secret_santa.db`), которая создаётся автоматически при первом запуске.

## Примечания

- Регистрация и обновление информации доступны только до проведения жеребьёвки
- Администраторы могут участвовать в игре и имеют доступ ко всем пользовательским командам
- Чёрный список учитывается при жеребьёвке, но каждый участник должен иметь хотя бы одного возможного получателя

## Лицензия

Этот проект создан для личного использования.

